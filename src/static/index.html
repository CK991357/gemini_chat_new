<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Chat Multimodal Live API Client</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="css/style.css">
    <!-- ÂºïÂÖ• MathJax Áî®‰∫éÊï∞Â≠¶ÂÖ¨ÂºèÊ∏≤Êüì -->
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <!-- ÂºïÂÖ• marked.js Áî®‰∫é Markdown Ê∏≤Êüì -->
    <script src="lib/marked-lib/marked.umd.js"></script>
    <!-- ÂºïÂÖ• highlight.js Áî®‰∫é‰ª£Á†ÅÈ´ò‰∫Æ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark-dimmed.min.css">
    <!-- Êñ∞Â¢ûÂ∑•‰ΩúÊµÅÊ†∑Âºè -->
    <link rel="stylesheet" href="css/workflow-ui.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- Êñ∞Â¢ûÔºöÂºïÂÖ• pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>
        // ËÆæÁΩÆ pdf.js worker ÁöÑË∑ØÂæÑ
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
    </script>
</head>
<body>
    <div id="toast-container"></div>
    <div class="app-container">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <nav class="app-nav">
            <div class="mode-switcher">
                <h1 class="app-title">Gemini Chat</h1>
                <button id="translation-mode-button" class="mode-button" title="Translate Mode"><i class="fa-solid fa-language"></i></button>
                <button id="chat-mode-button" class="mode-button active" title="Chat Mode"><i class="fa-solid fa-comments"></i></button>
                <button id="vision-mode-button" class="mode-button" title="Vision Mode"><i class="fas fa-chess-king"></i></button>
            </div>
            <div class="nav-tools">
                <button id="new-chat-button" title="New Chat"><i class="fa-solid fa-square-plus"></i></button>
                
                <!-- üéØ Ê†∏ÂøÉUI‰øÆÊîπÔºöÂ∞ÜÊñá‰ª∂ÁÆ°ÁêÜÂô®ÊåâÈíÆÁßªÂä®Âà∞Ê≠§Â§Ñ -->
                <button id="file-manager-button" title="‰ºöËØùÊñá‰ª∂"><i class="fa-solid fa-folder-open"></i></button>

                <button id="toggle-config" title="Settings"><i class="fa-solid fa-gear"></i></button>
                <button id="toggle-log" title="System Log"><i class="fa-solid fa-file-lines"></i></button>
                <button id="theme-toggle" class="mode-button" title="Toggle Theme"><i class="fa-solid fa-sun"></i></button>

            <!-- ÁßªÂä®Â™í‰ΩìÊéßÂà∂ÊåâÈíÆÂà∞ËøôÈáå -->
            <div class="media-controls">
                <button id="mic-button" class="media-button" title="Microphone"><i class="fa-solid fa-microphone"></i></button>
                <button id="camera-button" class="media-button" title="Camera"><i class="fa-solid fa-video"></i></button>
                <button id="screen-button" class="media-button" title="Screen Share"><i class="fa-solid fa-display"></i></button>
                <!-- ÁßªÈô§ÁøªËΩ¨ÊåâÈíÆ -->
                 </div>
            </div>
        </nav>

        <!-- ‰∏ªÂÆπÂô®ÔºöÂ∑¶Âè≥ÂàÜÊ†è -->
        <div class="main-container">
            <!-- Â∑¶‰æßÊéßÂà∂Èù¢Êùø -->
            <aside class="control-panel">
                <div class="settings-card">
                    <h3>ËÆæÁΩÆ</h3>
                    <div class="setting-item">
                        <label for="api-key">API Key:</label>
                        <input type="password" id="api-key" placeholder="Please Input Gemini API Key" />
                    </div>
                    <div class="setting-item">
                        <label for="voice-select">Â£∞Èü≥:</label>
                        <select id="voice-select">
                            <option value="Puck">Puck (Male)</option>
                            <option value="Charon">Charon (Male)</option>
                            <option value="Fenrir">Fenrir (Male)</option>
                            <option value="Kore">Kore (Female)</option>
                            <option value="Aoede" selected>Aoede (Female)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="response-type-select">ÂìçÂ∫îÁ±ªÂûã:</label>
                        <select id="response-type-select">
                            <option value="text">Text</option>
                            <option value="audio" selected>Audio</option>
                        </select>
                    </div>
                    <!-- Êñ∞Â¢ûÊ®°ÂûãÈÄâÊã©‰∏ãÊãâËèúÂçï -->
                    <div class="setting-item">
                        <label for="model-select">Ê®°ÂûãÈÄâÊã©:</label>
                        <select id="model-select">
                            <option value="models/gemini-2.0-flash-exp">gemini-2.0-flash-exp</option>
                            <option value="models/gemini-2.5-flash-preview-05-20" selected>gemini-2.5-flash-preview-05-20</option>
                        </select>
                    </div>
                    <!-- Êñ∞Â¢ûÔºöGemini ÊÄùÁª¥ÈìæÂºÄÂÖ≥ -->
                    <div class="setting-item setting-item-horizontal">
                        <label for="enable-reasoning-checkbox">Gemini ÊÄùÁª¥Èìæ:</label>
                        <label class="switch" for="enable-reasoning-checkbox" title="ÂêØÁî®ÂêéGeminiÊ®°Âûã‰ºöÊòæÁ§∫ÊÄùËÄÉËøáÁ®ã">
                            <input type="checkbox" id="enable-reasoning-checkbox" name="enableReasoning">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <!-- Êñ∞Â¢ûÔºöÊô∫ËÉΩ‰ª£ÁêÜÊ®°ÂºèÂºÄÂÖ≥ -->
                    <div class="setting-item setting-item-horizontal">
                        <label for="agent-mode-toggle">Êô∫ËÉΩ‰ª£ÁêÜÊ®°Âºè:</label>
                        <label class="switch" title="ÂêØÁî®ÂêéËá™Âä®ËßÑÂàíÂíåÊâßË°åÂ§çÊùÇ‰ªªÂä°">
                            <input type="checkbox" id="agent-mode-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="fps-input">ËßÜÈ¢ë FPS:</label>
                        <input type="number" id="fps-input" placeholder="Video FPS" value="1" min="1" max="30" step="1"/>
                        <span class="fps-help">Êõ¥È´ò FPS ÈúÄË¶ÅÊõ¥Â§öÁΩëÁªúÂ∏¶ÂÆΩ</span>
                    </div>
                    <div class="setting-item">
                        <label for="prompt-select">Êåá‰ª§Ê®°Âºè:</label>
                        <select id="prompt-select"></select>
                    </div>
                    <div class="setting-item full-width" style="display: none;">
                        <label for="system-instruction">Á≥ªÁªüÊåá‰ª§ (ÈöêËóè):</label>
                        <textarea id="system-instruction" placeholder="Enter custom system instructions..." rows="6"></textarea>
                    </div>
                    <div class="button-group">
                        <button id="apply-config" class="action-button">Á°ÆËÆ§</button>
                        <button id="connect-button" class="action-button primary">ËøûÊé•</button>
                    </div>
                    </div>
            </aside>

            <!-- Âè≥‰æß‰∏ªÂÜÖÂÆπÂå∫ -->
            <div class="content-area">
                <!-- Ê®°ÂºèÂàáÊç¢ÈÄâÈ°πÂç° -->
                <div class="mode-tabs">
                    <button class="tab active" data-mode="text">üìù ÊñáÂ≠óËÅäÂ§©</button>
                    <!-- <button class="tab" data-mode="audio">üéôÔ∏è Èü≥È¢ëËÅäÂ§©</button> Âà†Èô§Ê≠§Ë°å -->
                    <button class="tab" data-mode="log">üìã Á≥ªÁªüÊó•Âøó</button>
                    <button class="tab" data-mode="history">üìú ÂéÜÂè≤ËÆ∞ÂΩï</button>
                </div>

                <section class="chat-container text-mode active">
                  <div class="media-previews" id="media-previews">
                    <div id="video-container" class="media-preview">
                      <video id="preview" playsinline webkit-playsinline autoplay muted></video>
                      <div class="video-controls">
                        <button id="flip-camera" class="media-button" title="Flip Camera"><i class="fa-solid fa-camera-rotate"></i></button>
                        <button id="stop-video" class="close-button" title="Stop Video"><i class="fa-solid fa-xmark"></i></button>
                      </div>
                    </div>
                    <div id="screen-preview-container" class="media-preview">
                      <video id="screen-preview-element" playsinline webkit-playsinline autoplay muted></video>
                      <button id="stop-screen-button" class="close-button" title="Stop Screen Share"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                  </div>
                  
                  <!-- üöÄ Êñ∞Â¢ûÔºöÂ∑•‰ΩúÊµÅÂÆπÂô® -->
                  <div id="workflow-container" class="workflow-container"></div>

                  <div class="message-history" id="message-history">
                    <!-- ËÅäÂ§©Ê∂àÊÅØÂä®ÊÄÅÊèíÂÖ• -->
                  </div>

                  <!-- Êñ∞Â¢ûÔºöÊñá‰ª∂ÈôÑ‰ª∂È¢ÑËßàÂÆπÂô® -->
                  <div class="file-attachment-previews" id="file-attachment-previews">
                      <!-- ÈôÑ‰ª∂È¢ÑËßàÂ∞ÜÂä®ÊÄÅÊèíÂÖ•Ê≠§Â§Ñ -->
                  </div>
                  
                  <!-- ËæìÂÖ•Âå∫Âüü‰øùÊåÅ‰∏çÂèò -->

                    <div class="input-area">
                        <textarea id="message-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." rows="1"></textarea>
                        <button id="send-button" class="send-button" title="Send"><i class="fa-solid fa-paper-plane"></i></button>
                        <button id="interrupt-button" class="action-button" title="Interrupt">||</button>
                        <!-- Êñ∞Â¢ûÔºöÈôÑ‰ª∂ÊåâÈíÆ -->
                        <button id="attachment-button" class="action-button" title="Attach File"><i class="fa-solid fa-paperclip"></i></button>
                        <!-- Êñ∞Â¢ûÔºöËÅäÂ§©Ê®°Âºè‰∏ãÁöÑËØ≠Èü≥ËæìÂÖ•ÊåâÈíÆ -->
                        <button id="chat-voice-input-button" class="action-button" title="Voice Input"><i class="fa-solid fa-microphone"></i></button>
                        <input type="file" id="file-input"
       accept="image/*, application/pdf, video/*, audio/*, .xlsx,.xls,.parquet,.csv,.json,.txt"
       multiple style="display: none;">
                    </div>
                    
                </section>

                <!-- Á≥ªÁªüÊó•ÂøóÂå∫ (‰øùÊåÅ‰∏çÂèò) -->
                <section class="chat-container log-mode">
                    <div class="log-header">
                        <h3>Á≥ªÁªüÊó•Âøó</h3>
                        <button id="clear-logs" class="action-button">Ê∏ÖÁ©∫</button>
                    </div>
                    <div class="log-content" id="logs-container">
                        <!-- ÂéüÂßãÊó•ÂøóÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÊèíÂÖ•Ê≠§Â§Ñ -->
                    </div>
                </section>

                <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂå∫ -->
                <section class="chat-container history-mode">
                    <div class="log-header">
                        <h3>ÂéÜÂè≤ËÆ∞ÂΩï</h3>
                        <div class="history-controls">
                            <label for="history-enabled-switch" class="switch" title="ÂêØÁî®/Á¶ÅÁî®ÂéÜÂè≤ËÆ∞ÂΩï">
                                <input type="checkbox" id="history-enabled-switch" checked aria-label="ÂêØÁî®/Á¶ÅÁî®ÂéÜÂè≤ËÆ∞ÂΩï">
                                <span class="slider round"></span>
                            </label>
                            <button id="restore-history-btn" class="icon-button" title="‰ªé‰∫ëÁ´ØÊÅ¢Â§çÂéÜÂè≤ËÆ∞ÂΩï">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="batch-select-history-btn" class="icon-button" title="ÊâπÈáèÈÄâÊã©">
                               <i class="fas fa-check-square"></i>
                            </button>
                            <button id="delete-selected-history-btn" class="icon-button danger" title="Âà†Èô§ÊâÄÈÄâ" style="display: none;">
                               <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="history-list" id="history-list-container">
                        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®Â∞ÜÂä®ÊÄÅÊèíÂÖ•Ê≠§Â§Ñ -->
                    </div>
                </section>

                <!-- ÁøªËØëÂäüËÉΩÂå∫ -->
                <section class="translation-container">
                    <div class="translation-input-area">
                        <div class="translation-controls">
                            <select id="translation-input-language-select" title="ÈÄâÊã©ËæìÂÖ•ËØ≠Ë®Ä"></select>
                            <select id="translation-model-select" title="ÈÄâÊã©ÁøªËØëÊ®°Âûã">
                                <option value="gemini-2.5-flash-lite-preview-06-17" selected>gemini-2.5-flash-lite-preview-06-17</option>
                                <option value="THUDM/GLM-4-9B-0414">THUDM/GLM-4-9B-0414</option>
                            </select>
                        </div>
                        <textarea id="translation-input-text" placeholder="ËæìÂÖ•Ë¶ÅÁøªËØëÁöÑÂÜÖÂÆπ..." rows="10"></textarea>
                        <div class="translation-action-buttons">
                            <button id="translation-ocr-button" class="action-button" style="display: none;" title="OCR Translate"><i class="fa-solid fa-image"></i></button>
                            <input type="file" id="translation-ocr-input" accept="image/*" capture="environment" style="display: none;">
                            <button id="translate-button" class="action-button">ÁøªËØë</button>
                            <!-- Êñ∞Â¢ûÔºöÁøªËØëÊ®°Âºè‰∏ãÁöÑËØ≠Èü≥ËæìÂÖ•ÊåâÈíÆ -->
                            <button id="translation-voice-input-button" class="action-button">ËØ≠Èü≥ËæìÂÖ•</button>
                        </div>
                    </div>
                    <div class="translation-output-area">
                        <div class="translation-controls">
                            <select id="translation-output-language-select" title="ÈÄâÊã©ËæìÂá∫ËØ≠Ë®Ä"></select>
                        </div>
                        <div id="translation-output-text" class="translation-output-display"></div>
                        <button id="translation-copy-button" class="copy-button" title="Copy"><i class="fa-solid fa-copy"></i></button>
                    </div>
                </section>

                <section class="vision-container">
                  <!-- ËßÜËßâËÅäÂ§©ÂÖ®Â±èÊ®°Âºè -->
                  <div class="vision-chat-fullscreen active" id="vision-chat-fullscreen">
                    <div class="message-history" id="vision-message-history">
                      <!-- Vision chat messages will be dynamically inserted here -->
                    </div>

                    <div class="file-attachment-previews" id="vision-attachment-previews">
                      <!-- Attachment previews for vision mode will be dynamically inserted here -->
                    </div>

                    <div class="vision-controls">
                      <div class="vision-control-row">
                        <label for="vision-model-select">Ê®°Âûã:</label>
                        <select id="vision-model-select"></select>
                      </div>
                      <div class="vision-control-row">
                        <label for="vision-prompt-select">Ê®°Âºè:</label>
                        <select id="vision-prompt-select"></select>
                        <button id="vision-summary-button" class="action-button" title="ÁîüÊàêÂØπÂ±ÄÊÄªÁªì">ÂØπÂ±ÄÊÄªÁªì</button>
                        <button id="toggle-to-chess-button" class="action-button" title="ÂàáÊç¢Âà∞ÂõΩÈôÖË±°Ê£ãÊ£ãÁõò">ÂàáÊç¢Âà∞Ê£ãÁõò</button>
                      </div>
                    </div>
                    
                    <div class="input-area" id="vision-input-area">
                      <textarea id="vision-input-text" placeholder="ËæìÂÖ•ÊèèËø∞ÊàñÈóÆÈ¢ò..." rows="1"></textarea>
                      <button id="vision-attachment-button" class="action-button" title="Attach File"><i class="fa-solid fa-paperclip"></i></button>
                      <input type="file" id="vision-file-input"
       accept=".xlsx,.xls,.parquet,.csv,.json,.txt,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,image/*,video/*,audio/*,application/pdf"
       multiple style="display: none;">
                      <button id="vision-send-button" class="send-button" title="Send"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                  </div>

                  <!-- Ê£ãÁõòÂÖ®Â±èÊ®°Âºè -->
                  <div class="chess-fullscreen" id="chess-fullscreen">
                    <div class="chess-content-wrapper">
                      <div class="chess-board-area">
                        <!-- Ê£ãÁõòÂÆπÂô®Â∫îËØ•Âú®ËøôÈáå -->
                        <div id="chess-board" class="chess-board"></div>
                        
                        <!-- ‰ø°ÊÅØÈù¢Êùø -->
                        <div class="chess-info-panel">
                            <h3>ÂõΩÈôÖË±°Ê£ãÊ£ãÁõò</h3>
                            <div class="fen-display">
                                <label for="fen-output">ÂΩìÂâçFEN:</label>
                                <textarea id="fen-output" class="fen-text" readonly></textarea>
                                <div class="fen-actions">
                                    <button id="copy-fen-button" class="action-button">Â§çÂà∂FEN</button>
                                    <button id="reset-chess-button" class="action-button">Êñ∞Ê∏∏Êàè</button>
                                    <button id="undo-move-button" class="action-button">‰∏ä‰∏ÄÊ≠•</button>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                    <!-- ÂÖ®Â±èÊ®°Âºè‰∏ãÁöÑÊéßÂà∂ÊåâÈíÆ -->
                    <div class="fullscreen-controls">
                      <button id="toggle-to-vision-button" class="action-button">ÂàáÊç¢Âà∞ËÅäÂ§©</button>
                    </div>
                  </div>
                </section>

            </div>
        </div>

    </div>

    <!-- Image Modal Structure -->
    <div id="image-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-image-modal">&times;</span>
            <h2 class="modal-title" id="modal-image-title">ÂõæÁâáËØ¶ÊÉÖ</h2>
            <div class="modal-image-container">
                <img id="modal-image-display" src="" alt="ÂõæÁâáËØ¶ÊÉÖ">
            </div>
            <div class="modal-info">
                <p><i class="fa-solid fa-info-circle"></i> **Ê†áÈ¢ò:** <span id="modal-image-info-title">N/A</span></p>
                <p><i class="fa-solid fa-maximize"></i> **Â∞∫ÂØ∏:** <span id="modal-image-info-dimensions">N/A</span></p>
                <p><i class="fa-solid fa-weight-hanging"></i> **Â§ßÂ∞è:** <span id="modal-image-info-size">N/A</span></p>
                <p><i class="fa-solid fa-file-image"></i> **Á±ªÂûã:** <span id="modal-image-info-type">N/A</span></p>
                <p><i class="fa-solid fa-link"></i> **ÂéüÂßãÈìæÊé•:** <a id="modal-image-info-url" href="#" target="_blank" rel="noopener noreferrer">N/A</a></p>
            </div>
            <div class="modal-actions">
                <button class="action-button copy-button" id="copy-image-url-button" title="Copy Image URL"><i class="fa-solid fa-copy"></i> Â§çÂà∂ÈìæÊé•</button>
                <a id="download-image-button" class="action-button primary-button" download title="Download Image">
                    <i class="fa-solid fa-download"></i> ‰∏ãËΩΩÂõæÁâá
                </a>
            </div>
        </div>
    </div>

    <!-- üéØ Ê†∏ÂøÉUIÂçáÁ∫ßÔºöÊµÆÁ™óÂºèÊñá‰ª∂ÁÆ°ÁêÜÂô® (ÈªòËÆ§ÈöêËóè) -->
    <div id="file-manager-modal" class="file-manager-modal">
        <div class="file-manager-content">
            <div class="fm-header">
                <h2>‰ºöËØùÊñá‰ª∂ÁÆ°ÁêÜÂô®</h2>
                <button id="close-file-manager" class="fm-close-btn">&times;</button>
            </div>
            <div class="fm-search-container">
                <input type="text" id="file-manager-search" placeholder="ÊêúÁ¥¢Êñá‰ª∂Âêç..." />
            </div>
            <div id="file-list-container" class="fm-list-container">
                <!-- Êñá‰ª∂ÂàóË°®Â∞ÜÂä®ÊÄÅÊèíÂÖ•Ê≠§Â§Ñ -->
            </div>
            <div class="fm-footer">
                <button id="refresh-file-list" class="fm-btn fm-btn-secondary">
                    <i class="fa-solid fa-sync-alt"></i> Âà∑Êñ∞ÂàóË°®
                </button>
            </div>
        </div>
    </div>

    <script src="js/main.js" type="module"></script>
    <!-- chess.js for SAN move validation and parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
</body>
</html>
